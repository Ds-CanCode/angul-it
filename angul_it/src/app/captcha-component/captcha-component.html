<div class="captcha-container" *ngIf="currentChallenge && currentState">
  <div class="captcha-card">
    <div class="header">
      <div class="progress-section">
        <div class="progress-label">
          Challenge {{ getChallengeNumber() }}
        </div>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="getProgress()"></div>
        </div>
      </div>
    </div>

    <div class="challenge-content">
      <h2 class="question">{{ currentChallenge.question }}</h2>

      <!-- Image Select Challenge -->
      <div *ngIf="currentChallenge.type === 'image-select'" class="image-grid">
        <div 
          *ngFor="let option of currentChallenge.options"
          class="image-option"
          [class.selected]="isSelected(option.id)"
          (click)="toggleOption(option.id)">
          <div class="image-content">
            <span class="emoji-image">{{ option.imageUrl }}</span>
          </div>
          <div class="selection-indicator" *ngIf="isSelected(option.id)">
            ✓
          </div>
        </div>
      </div>

      <!-- Text Input Challenge -->
      <div *ngIf="currentChallenge.type === 'text-input'" class="text-input-container">
        <div class="display-text">AngulIt2026</div>
        <input 
          type="text" 
          class="text-input"
          [(ngModel)]="textInput"
          placeholder="Enter the text above"
          (keyup.enter)="submitAnswer()"
          [disabled]="isSubmitting">
      </div>

      <!-- Puzzle Challenge -->
      <div *ngIf="currentChallenge.type === 'puzzle'" class="puzzle-container">
        <div class="puzzle-display">
          <span class="puzzle-number">15</span>
          <span class="puzzle-operator">+</span>
          <span class="puzzle-number">27</span>
          <span class="puzzle-operator">=</span>
          <span class="puzzle-question">?</span>
        </div>
        <input 
          type="number" 
          class="puzzle-input"
          [(ngModel)]="textInput"
          placeholder="Enter your answer"
          (keyup.enter)="submitAnswer()"
          [disabled]="isSubmitting">
      </div>

      <!-- Slider Challenge -->
      <div *ngIf="currentChallenge.type === 'slider'" class="slider-container">
        <div class="slider-label">
          Current: <span class="slider-value">{{ sliderValue }}</span>
        </div>
        <input 
          type="range" 
          class="slider"
          min="0"
          max="100"
          [(ngModel)]="sliderValue"
          (input)="onSliderChange($event)"
          [disabled]="isSubmitting">
        <div class="slider-markers">
          <span>0</span>
          <span>50</span>
          <span>100</span>
        </div>
      </div>

      <div *ngIf="errorMessage" class="error-message">
        {{ errorMessage }}
      </div>
    </div>

    <div class="actions">
      <button 
        class="btn btn-secondary"
        (click)="previousChallenge()"
        [disabled]="!canGoPrevious() || isSubmitting">
        ← Previous
      </button>
      
      <button 
        class="btn btn-primary"
        (click)="submitAnswer()"
        [disabled]="isSubmitting"
        [class.loading]="isSubmitting">
        <span *ngIf="!isSubmitting">Submit</span>
        <span *ngIf="isSubmitting">Verifying...</span>
      </button>
    </div>
  </div>

  <div class="decoration-bg">
    <div class="grid-line" *ngFor="let i of [1,2,3,4,5,6]"></div>
  </div>
</div>